{% extends 'base_report.html' %}

{% block title %}Moje Finanse{% endblock %}

{% block style %}

    <!-- Bootstrap core CSS -->
	<link href="/bootstrap-4.0.0-dist/css/bootstrap.css" rel="stylesheet">
	<!-- Report Style CSS -->
	<link href="/css/report_style.css" rel="stylesheet">
	<link href="/bootstrap-4.0.0-dist/css/dashboard.css" rel="stylesheet">
	<!--Dodatkowe Fonty -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	
	<!-- Google Fonts Roboto -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
	<!-- Bootstrap core CSS -->
	<!--<link rel="stylesheet" href="/css/bootstrap.min.css"> -->
	<!-- MDBootstrap Datatables  -->
	<link href="/css/addons/datatables2.min.css" rel="stylesheet">

	<!-- Material Design Bootstrap -->
	<link rel="stylesheet" href="/css/mdb.min.css">
	<!-- Your custom styles (optional) -->
	<link rel="stylesheet" href="/css/style.css">

{% endblock %}

{% block body %}  

<!-- Show Incomes script-->
	<script type="text/javascript">
    function showIncome() {
		$(document).ready($('#modalIncome').modal('show'));	
    }
	</script>
<!-- End of Show Incomes script-->

<!-- Show Expences script-->
	<script type="text/javascript">
    function showExpence() {
		$(document).ready($('#modalExpence').modal('show'));	
    }
	</script>
<!-- End of Show Expences script-->


<!-- Finance Manager Content-->
<div class="container-fluid">
	{{option}}
	
	
	
	<!-- Editable table -->
	<div class="card">
	  <h3 class="card-header text-center font-weight-bold text-uppercase py-4">Editable table</h3>
	  <div class="card-body">
		<div id="table" class="table-editable">
		  <span class="table-add float-right mb-3 mr-2"><a href="#!" class="text-success"><i
				class="fas fa-plus fa-2x" aria-hidden="true"></i></a></span>
		  <table class="table table-bordered table-responsive-md table-striped text-center">
			<thead>
			  <tr>
				<th class="text-center">Kategoria</th>
				<th class="text-center">Maxymalny Limit</th>
			  </tr>
			</thead>
			<tbody>
			
				{% for category in incomeCategories %}
				  <tr>
					<td class="pt-3-half" contenteditable="true">{{category.name}}</td>
					<td class="pt-3-half" contenteditable="true">{{category.max}}</td>
					<td class="pt-3-half">
					  <span class="table-up"><a href="#!" class="indigo-text"><i class="fas fa-long-arrow-alt-up"
							aria-hidden="true"></i></a></span>
					  <span class="table-down"><a href="#!" class="indigo-text"><i class="fas fa-long-arrow-alt-down"
							aria-hidden="true"></i></a></span>
					</td>
					<td>
					  <span class="table-remove"><button type="button"
						  class="btn btn-danger btn-rounded btn-sm my-0">Remove</button></span>
					</td>
				  </tr>
				{% endfor %}

					<div id="wynik"></div>
			</tbody>
		  </table>
		</div>
	  </div>
	</div>
	<!-- Editable table -->
</div><!-- /.container-fluid-->

	

	
	<!-- jQuery -->
	<script type="text/javascript" src="/js/jquery.min.js"></script>
	<!-- Bootstrap tooltips -->
	<script type="text/javascript" src="/js/popper.min.js"></script>
	<!-- Bootstrap core JavaScript -->
	<script type="text/javascript" src="/js/bootstrap.min.js"></script>
	<!-- MDB core JavaScript -->
	<script type="text/javascript" src="/js/mdb.min.js"></script>
	<!-- Your custom scripts (optional) -->
	<script type="text/javascript"></script>

	<!-- MDBootstrap Datatables  -->
	<script type="text/javascript" src="/js/addons/datatables2.min.js"></script>


	<script>
		const $tableID = $('#table');
		const $BTN = $('#export-btn');
		const $EXPORT = $('#export');

		const $newCategory = `
		<tr>
					<td class="pt-3-half" contenteditable="true">Nowa Kategoria</td>
					<td class="pt-3-half" contenteditable="true">1000</td>
					<td class="pt-3-half">
					  <span class="table-up"><a href="#!" class="indigo-text"><i class="fas fa-long-arrow-alt-up"
							aria-hidden="true"></i></a></span>
					  <span class="table-down"><a href="#!" class="indigo-text"><i class="fas fa-long-arrow-alt-down"
							aria-hidden="true"></i></a></span>
					</td>
					<td>
					  <span class="table-remove"><button type="button"
						  class="btn btn-danger btn-rounded btn-sm my-0">Remove</button></span>
					</td>
		</tr>`;
		
		var newCategory = $tableID.find('tr:last td:first').text();
		$("#wynik").text(newCategory);
		var contents = $('#table table tbody tr:last td:first').html();

		//dodawanie nowej kategori jeśli nie istnieje
		 $('.table-add').on('click', 'i', () => {
		   const $clone = $tableID.find('tbody tr').last().clone(true);
		   newCategory = $tableID.find('tr:last td:first').text();
		   if ((newCategory !== 'Nowa Kategoria')) {
			 $('#table table tbody').append($newCategory);
			 newCategory = $tableID.find('tr:last td:first').text();
			 contents = $('#table table tbody tr:last td:first').html();
			 $('.table-add').find('a').hide();
		   }
		 });		
		
		//Zmiana Danych	w ostatniej komórce	
		$tableID.on('blur','tr:last td:first',function() {
			if (contents!=$(this).html()){
				$('.table-add').find('a').show();
				contents = $(this).html();
			}
		});




		//usuwanie linijki
		 $tableID.on('click', '.table-remove', function () {
		   $(this).parents('tr').detach();
		 });

		//przesuwanie kategori do góry
		 $tableID.on('click', '.table-up', function () {
		   const $row = $(this).parents('tr');
		   if ($row.index() === 0) {
			 return;
		   }
		   $row.prev().before($row.get(0));
		 });

		//przesuwanie kategorii w dół
		 $tableID.on('click', '.table-down', function () {

		   const $row = $(this).parents('tr');
		   $row.next().after($row.get(0));
		 });

		 // A few jQuery helpers for exporting only
		 jQuery.fn.pop = [].pop;
		 jQuery.fn.shift = [].shift;

		 $BTN.on('click', () => {

		   const $rows = $tableID.find('tr:not(:hidden)');
		   const headers = [];
		   const data = [];

		   // Get the headers (add special header logic here)
		   $($rows.shift()).find('th:not(:empty)').each(function () {

			 headers.push($(this).text().toLowerCase());
		   });

		   // Turn all existing rows into a loopable array
		   $rows.each(function () {
			 const $td = $(this).find('td');
			 const h = {};

			 // Use the headers from earlier to name our hash keys
			 headers.forEach((header, i) => {

			   h[header] = $td.eq(i).text();
			 });

			 data.push(h);
		   });

		   // Output the result
		   $EXPORT.text(JSON.stringify(data));
		 });
	</script>
	
	<!-- feather icons  -->
	<script>feather.replace()</script>
	<!-- End of feather icons  -->
{% endblock %}